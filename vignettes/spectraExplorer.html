<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Julien Wist" />

<meta name="date" content="2019-03-03" />

<title>Spectra Explorer</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Spectra Explorer</h1>
<h4 class="author"><em>Julien Wist</em></h4>
<h4 class="date"><em>2019-03-03</em></h4>



<div id="prepare-your-data" class="section level2">
<h2>Prepare your data</h2>
<p>To give an example on how to prepare data, we will use a dataset used in another analysis<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The dataset is provided with the package <code>visualizeR</code> and can be called with the <code>data()</code> function.</p>
<p>Since the data have been prepared for another analysis, the data have to be reshaped to be used in the <code>visualizeR</code> pipeline. The following elements must be present:</p>
<ul>
<li>a vector <code>ID</code> of <strong>unique</strong> IDs that is used to identify each entry or sample</li>
<li>a vector <code>group</code> that describes to which class each sample belong</li>
<li>a table <code>metadata</code> of information that belong to each sample and that will be displayed</li>
<li>a matrix <code>x</code> that contains the data. Each row represents a sample, each columns a variable</li>
<li>a vector <code>x_axis</code> that contains the names or values of each variable</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;coffeeNMRSpectra&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">ID &lt;-<span class="st"> </span>coffeeNMRSpectra<span class="op">$</span>param<span class="op">$</span>catalogID</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">group &lt;-<span class="st"> </span>coffeeNMRSpectra<span class="op">$</span>param<span class="op">$</span>country1</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">metadata &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="kw">sapply</span>(coffeeNMRSpectra<span class="op">$</span>param, <span class="cf">function</span>(x) x) )</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sapply</span>(<span class="kw">I</span>(<span class="kw">as.matrix</span>(coffeeNMRSpectra<span class="op">$</span>nmr)), <span class="cf">function</span>(x) x), <span class="dv">34</span>, <span class="dv">1610</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">x_axis &lt;-<span class="st"> </span><span class="kw">as.numeric</span>( <span class="kw">colnames</span>(coffeeNMRSpectra<span class="op">$</span>nmr) )</a></code></pre></div>
<p>You can verify that the data includes 34 NMR spectra of Arabica coffee from Brazil, Colombia and Peru. The original data of lenght 1.3107210^{5} have been binned or bucketed down to 1610 variables.</p>
<p>The <code>visualizeR</code> pipeline needs JSON files<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> that look like:</p>
<p>{‘a’: 1}</p>
<p>where the object contains a key <code>a</code> that has a value <code>1</code>. JSON are object natively supported in JavaScript, but not very handy in R. In R, the best way to represent a JSON is using a <code>list()</code>. So each object that must be passed to the <code>visualizeR</code> has to be added to a list using the <code>appendData()</code> function. Let’s create the data object with the following block of commands.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">d =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">c &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ID =</span> ID,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                <span class="dt">group =</span> group,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                <span class="dt">color =</span> <span class="kw">sapply</span>(group, <span class="cf">function</span>(x) <span class="kw">getColor2</span>(<span class="kw">as.character</span>(x))),</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                <span class="st">&quot;_highlight&quot;</span> =<span class="st"> </span><span class="kw">seq_along</span>(group),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                <span class="dt">dataMatrix =</span> <span class="kw">I</span>(<span class="kw">matrix</span>( <span class="kw">c</span>(<span class="kw">rbind</span>(<span class="kw">repRow</span>(x_axis, <span class="kw">nrow</span>(x)), x)), <span class="kw">nrow</span>(x), <span class="kw">ncol</span>(x)<span class="op">*</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">                <span class="dt">metadata =</span> <span class="kw">I</span>(metadata),</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                <span class="dt">check.names =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">d &lt;-<span class="st"> </span><span class="kw">appendData</span>(<span class="dt">data =</span> d, <span class="dt">variableName =</span> <span class="st">&quot;data&quot;</span>, <span class="dt">variable =</span> c, <span class="dt">type =</span> <span class="st">&quot;table&quot;</span>)</a></code></pre></div>
<p>Note that a vector <code>_highlight</code> has been added for internal use. It consist of a unique index and is used to provide highlight of object when hoovered by the mouse in the <code>visualizer</code>. Here a simple sequence is used, but in principle any vector of unique IDs could be used.</p>
<p>Now your data are ready to be pushed to the <code>http://github.com/npellet/visualizer</code>.</p>
</div>
<div id="univariate-statistics" class="section level2">
<h2>Univariate statistics</h2>
<p>Before pushing your data you may want to compute univariate statistics using R and display it when you explore your data. In this example, boxplots by groups are calculated for each variable. Because we will visualize our date in a webpage, all the figure are exported as png and encoded in base 64. This is a convenient way to display figure in a webpage that are embedded directly into the webpage. But because embedding does’t compress the images, the resulting file weight accordingly.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">imag =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">3220</span>, <span class="dt">by=</span><span class="dv">2</span>)) {</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="kw">png</span>(tf1 &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.png&quot;</span>));  <span class="kw">boxplot</span>( dataMatrix[,i] <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> c); <span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  imag[[i<span class="op">/</span><span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;data:image/png;base64,&quot;</span>, base64enc<span class="op">::</span><span class="kw">base64encode</span>(tf1))<span class="co">#base64enc::base64encode(tf1)</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">l &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;_highlight&quot;</span> =<span class="st"> </span><span class="kw">seq_along</span>(x_axis),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                <span class="co">#value = paste0(&quot;data:image/png;base64,&quot;, base64enc::base64encode(tf1)),</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">                <span class="dt">value =</span> <span class="kw">unlist</span>(imag),</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">                <span class="dt">check.names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">d &lt;-<span class="st"> </span><span class="kw">appendData</span>(<span class="dt">data =</span> d, <span class="dt">variableName =</span> <span class="st">&quot;img&quot;</span>, <span class="dt">variable =</span> l, <span class="dt">type =</span> <span class="st">&quot;table&quot;</span>)</a></code></pre></div>
<p>Note that after computing the boxplots, a data.frame is created and appended to the same list with name <code>img</code>. That is the list <code>d</code> now contains two elements:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">names</span>(d)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; [1] &quot;data&quot; &quot;img&quot;</span></a></code></pre></div>
</div>
<div id="set-up-the-visualization" class="section level2">
<h2>Set up the visualization</h2>
<p>The <code>http://github.com/npellet/visualizer</code> needs 3 parts to work:</p>
<ol style="list-style-type: decimal">
<li>The visualizer itself that contains the code to visualize various kind of data interactively</li>
<li>a JSON file with data, usually named as data.json</li>
<li>a JSON file with information of how to display the data, usually referred to as view.json</li>
</ol>
<p>Here we just created a data.json file and we need to tell the webserver its name. Therefore we create a new visualization object and tell him where both the data and the view are to be found. The view has been created for this example and thus we just have to indicate the name of the file, while the data are the one we just created. The <code>visualizer::push()</code> function allows to serve the data just created under a specified name.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># v &lt;- new(&quot;visualization&quot;)</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># v@view &lt;- &quot;spectraExplorer3.1.view.json&quot;</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># v@data &lt;- &quot;spectraExplorer3.data.json&quot;</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># push(v, type=&quot;data&quot;, d)</span></a></code></pre></div>
<p><code>v</code> is an object that contains the configuration of the webserver. The method <code>print()</code> permit to see the final url. The first part of the URL point to the <code>http://github.com/npellet/visualizer</code> itself, while the second and thirs points to the data and the view, i.e., how to display the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># print(v)</span></a></code></pre></div>
</div>
<div id="explore-your-data" class="section level2">
<h2>Explore your data</h2>
<p>Use the commented function, directly into the console to start the webserver and interact with your data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">#visualize(v)</span></a></code></pre></div>
</div>
<div id="troubleshooting" class="section level2">
<h2>Troubleshooting</h2>
<p>Click the following <a href="https://my.cheminfo.org/?viewURL=https://gist.githubusercontent.com/jwist/226596ad9ed6b25b790a61870fb76f33/raw/spectraExplorer3.1.view.json&amp;dataURL=https://gist.githubusercontent.com/jwist/aacb0b820c823f38863b9fd3d065c839/raw/spectraExplorer3.data.json">link</a> to see a demo version of the result you should obtain.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.hindawi.com/journals/ijac/2017/7210463/">Comparison of Attenuated Total Reflectance Mid-Infrared, Near Infrared, and 1H-Nuclear Magnetic Resonance Spectroscopies for the Determination of Coffee’s Geographical Origin</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><a href="http://www.json.org/">see JSON webpage</a><a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
