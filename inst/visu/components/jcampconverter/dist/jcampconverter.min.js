(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b():'function'==typeof define&&define.amd?define([],b):'object'==typeof exports?exports.JcampConverter=b():a.JcampConverter=b()})(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a){'use strict';function b(){function a(a){for(var b=a.length,c=Array(b),d=0;d<b;d++)c[d]=parseFloat(a[d]);return c}function b(a){return a.toLowerCase().replace(/[^a-z0-9]/g,'')}function c(a){return-1!==o.indexOf(a)}function d(a){var c,d=a.spectra,e=d.length,f={times:Array(e),series:{ms:{dimension:2,data:Array(e)}}},g=[];for(c=0;c<o.length;c++){var h=b(o[c]);d[0][h]&&(g.push(h),f.series[h]={dimension:1,data:Array(e)})}for(c=0;c<e;c++){var i=d[c];f.times[c]=i.pageValue;for(var k=0;k<g.length;k++)f.series[g[k]].data[c]=parseFloat(i[g[k]]);i.data&&(f.series.ms.data[c]=[i.data[0].x,i.data[0].y])}a.chromatogram=f}function e(a){var b=a.spectra[0].data[0];a.chromatogram={times:b.x.slice(),series:{intensity:{dimension:1,data:b.y.slice()}}}}function f(a,b){if(b.xFactor||(b.xFactor=1),b.yFactor||(b.yFactor=1),b.observeFrequency&&b.xUnit&&'HZ'===b.xUnit.toUpperCase()&&(b.xUnit='PPM',b.xFactor/=b.observeFrequency,b.firstX/=b.observeFrequency,b.lastX/=b.observeFrequency,b.deltaX/=b.observeFrequency),a.shiftOffsetVal){var c=b.firstX-a.shiftOffsetVal;b.firstX-=c,b.lastX-=c}}function g(a){a=a.sort(h);var b=a.length;return a[Math.floor(b/2)]}function h(c,a){return c-a}function i(a){for(var b=a[0].data[0][0],c=b,d=a.length,e=a[0].data[0].length/2,f=Array(d),h=0;h<d;h++){f[h]=Array(e);for(var i,k=a[h].data[0],l=0;l<e;l++)i=k[2*l+1],f[h][l]=i,i<b&&(b=i),i>c&&(c=i)}return{z:f,minX:a[0].data[0][0],maxX:a[0].data[0][a[0].data[0].length-2],minY:a[0].pageValue,maxY:a[d-1].pageValue,minZ:b,maxZ:c,noise:g(f[0].map(Math.abs))}}function l(a,b){var c=i(a.spectra);b.noContour||(a.contourLines=j(c,b),delete c.z),a.minMax=c}function j(a,b){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.noise,r=a.z,s=r.length,t=r[0].length,u=a.minX,v=a.maxX,w=(v-u)/(t-1),x=a.minY,y=a.maxY,z=(y-x)/(s-1),A=a.minZ,B=a.maxZ,C=2*b.nbContourLevels,D=Array(C),E=0;E<C;E++){p={},D[E]=p;var F=E%2,G=(B-b.noiseMultiplier*q)*Math.exp((E>>1)-b.nbContourLevels);o=0==F?G+b.noiseMultiplier*q:0-G-b.noiseMultiplier*q;var H=[];if(p.zValue=o,p.lines=H,!(o<=A||o>=B))for(var I=0;I<s-1;I++)for(var J=r[I],K=r[I+1],L=0;L<t-1;L++)c=J[L],d=J[L+1],e=K[L],f=K[L+1],g=c>o,h=d>o,i=e>o,j=f>o,g!==h&&g!==i&&(k=L+(o-c)/(d-c),l=I,m=L,n=I+(o-c)/(e-c),H.push(k*w+u),H.push(l*z+x),H.push(m*w+u),H.push(n*z+x)),j!==h&&j!==i&&(k=L+1,l=I+1-(o-f)/(d-f),m=L+1-(o-f)/(e-f),n=I+1,H.push(k*w+u),H.push(l*z+x),H.push(m*w+u),H.push(n*z+x)),h!==i&&(k=(L+1-(o-d)/(e-d))*w+u,l=(I+(o-d)/(e-d))*z+x,h!==g&&(m=L+1-(o-d)/(c-d),n=I,H.push(k),H.push(l),H.push(m*w+u),H.push(n*z+x)),i!==g&&(m=L,n=I+1-(o-e)/(c-e),H.push(k),H.push(l),H.push(m*w+u),H.push(n*z+x)),h!==j&&(m=L+1,n=I+(o-d)/(f-d),H.push(k),H.push(l),H.push(m*w+u),H.push(n*z+x)),i!==j&&(m=L+(o-e)/(f-e),n=I+1,H.push(k),H.push(l),H.push(m*w+u),H.push(n*z+x)))}return{minX:a.minX,maxX:a.maxX,minY:a.minY,maxY:a.maxY,segments:D}}function k(a,b){var c=a.yFactor,d=a.deltaX;a.isXYdata=!0;var e=[];a.data=[e];for(var f,g=a.firstX,h=a.firstY,k=!1,l=0;l<b.length;l++)if(f=b.charCodeAt(l),13===f||10===f)k=!0;else if(k)break;for(var i=!0,m=!1,n=!1,o=0,p=!1,q=!1,r=0,s=!1,t=!1,u=!1,v=0;l<=b.length;l++)if(f=l===b.length?13:b.charCodeAt(l),q)(13===f||10===f)&&(i=!0,q=!1);else if(57>=f&&48<=f)t=!0,0<v?r+=(f-48)/Math.pow(10,v++):(r*=10,r+=f-48);else if(44===f||46===f)t=!0,v++;else{if(t){if(i)i=!1,n&&(u=!0);else if(u)u=!1;else{m&&(o=s?0-r:r,n=!0,m=!1);for(var w=p?r-1:1,x=0;x<w;x++)n?h+=o:h=s?0-r:r,e.push(g),e.push(h*c),g+=d}s=!1,r=0,v=0,t=!1,p=!1}if(74>f&&63<f)t=!0,n=!1,r=f-64;else if(96<f&&106>f)t=!0,n=!1,r=f-96,s=!0;else if(115===f)t=!0,p=!0,r=9;else if(82<f&&91>f)t=!0,p=!0,r=f-82;else if(73<f&&83>f)t=!0,m=!0,r=f-73;else if(105<f&&115>f)t=!0,m=!0,r=f-105,s=!0;else if(36===f&&36===b.charCodeAt(l+1))t=!0,q=!0;else if(37===f)t=!0,m=!0,r=0,s=!1;else if(45===f){var j=b.charCodeAt(l+1);(48<=j&&57>=j||44===j||46===j)&&(t=!0,n=!1,s=!0)}else(13===f||10===f)&&(i=!0,q=!1)}}function m(a,b,c){var d=/\$\$.*/,e=/[,\t ]+/;a.isPeaktable=!0;var f,g,h,i,j,k=[];a.data=[k];var l=b.split(/,? *,?[;\r\n]+ */);for(f=1,g=l.length;f<g;f++)if(j=l[f].trim().replace(d,'').split(e),0==j.length%2)for(h=0,i=j.length;h<i;h+=2)k.push(parseFloat(j[h])*a.xFactor),k.push(parseFloat(j[h+1])*a.yFactor);else c.logs.push('Format error: '+j)}var n=/[, \t]+/,o=['TIC','.RIC','SCANNUMBER'];class p{}var q={keepRecordsRegExp:/^$/,xy:!1,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5};return function(g,h){h=Object.assign({},q,h);var o,r,s,t,u,i,v,j,w,x,y=!h.withoutXY,z=Date.now(),A={},B={};B.profiling=[],B.logs=[];var C=[];B.spectra=C,B.info={};var D=new p;if('string'!=typeof g)throw new TypeError('the JCAMP should be a string');for(B.profiling&&B.profiling.push({action:'Before split to LDRS',time:Date.now()-z}),t=g.split(/[\r\n]+##/),B.profiling&&B.profiling.push({action:'Split to LDRS',time:Date.now()-z}),t[0]&&(t[0]=t[0].replace(/^[\r\n ]*##/,'')),(u=0,i=t.length);u<i;u++){if(o=t[u],j=o.indexOf('='),0<j?(r=o.substring(0,j),s=o.substring(j+1).trim()):(r=o,s=''),r=r.replace(/[_ -]/g,'').toUpperCase(),'DATATABLE'===r&&(w=s.indexOf('\n'),-1===w&&(w=s.indexOf('\r')),0<w)){var E=-1,F=-1;if(x=s.substring(0,w).split(/[ ,;\t]+/),0<x[0].indexOf('++')){var G=x[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,'$1'),H=x[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,'$1');E=A.symbol.indexOf(G),F=A.symbol.indexOf(H)}-1===E&&(E=0),-1===F&&(F=0),A.first&&(A.first.length>E&&(D.firstX=A.first[E]),A.first.length>F&&(D.firstY=A.first[F])),A.last&&(A.last.length>E&&(D.lastX=A.last[E]),A.last.length>F&&(D.lastY=A.last[F])),A.vardim&&A.vardim.length>E&&(D.nbPoints=A.vardim[E]),A.factor&&(A.factor.length>E&&(D.xFactor=A.factor[E]),A.factor.length>F&&(D.yFactor=A.factor[F])),A.units&&(A.units.length>E&&(D.xUnit=A.units[E]),A.units.length>F&&(D.yUnit=A.units[F])),D.datatable=x[0],x[1]&&-1<x[1].indexOf('PEAKS')?r='PEAKTABLE':x[1]&&(x[1].indexOf('XYDATA')||0<x[0].indexOf('++'))&&(r='XYDATA',D.deltaX=(D.lastX-D.firstX)/(D.nbPoints-1))}if('XYDATA'===r){y&&(f(B,D),s.match(/.*\+\+.*/)?(!D.deltaX&&(D.deltaX=(D.lastX-D.firstX)/(D.nbPoints-1)),k(D,s,B)):m(D,s,B),C.push(D),D=new p);continue}else if('PEAKTABLE'===r){y&&(f(B,D),m(D,s,B),C.push(D),D=new p);continue}if('TITLE'===r)D.title=s;else if('DATATYPE'===r)D.dataType=s,-1<s.indexOf('nD')&&(B.twoD=!0);else if('NTUPLES'===r)-1<s.indexOf('nD')&&(B.twoD=!0);else if('XUNITS'===r)D.xUnit=s;else if('YUNITS'===r)D.yUnit=s;else if('FIRSTX'===r)D.firstX=parseFloat(s);else if('LASTX'===r)D.lastX=parseFloat(s);else if('FIRSTY'===r)D.firstY=parseFloat(s);else if('LASTY'===r)D.lastY=parseFloat(s);else if('NPOINTS'===r)D.nbPoints=parseFloat(s);else if('XFACTOR'===r)D.xFactor=parseFloat(s);else if('YFACTOR'===r)D.yFactor=parseFloat(s);else if('DELTAX'===r)D.deltaX=parseFloat(s);else if('.OBSERVEFREQUENCY'===r||'$SFO1'===r)D.observeFrequency||(D.observeFrequency=parseFloat(s));else if('.OBSERVENUCLEUS'===r)D.xType||(B.xType=s.replace(/[^a-zA-Z0-9]/g,''));else if('$SFO2'===r)B.indirectFrequency||(B.indirectFrequency=parseFloat(s));else if('$OFFSET'===r)B.shiftOffsetNum=0,B.shiftOffsetVal||(B.shiftOffsetVal=parseFloat(s));else if('$REFERENCEPOINT'===r);else if('VARNAME'===r)A.varname=s.split(n);else if('SYMBOL'===r)A.symbol=s.split(n);else if('VARTYPE'===r)A.vartype=s.split(n);else if('VARFORM'===r)A.varform=s.split(n);else if('VARDIM'===r)A.vardim=a(s.split(n));else if('UNITS'===r)A.units=s.split(n);else if('FACTOR'===r)A.factor=a(s.split(n));else if('FIRST'===r)A.first=a(s.split(n));else if('LAST'===r)A.last=a(s.split(n));else if('MIN'===r)A.min=a(s.split(n));else if('MAX'===r)A.max=a(s.split(n));else if('.NUCLEUS'===r)B.twoD&&(B.yType=s.split(n)[0]);else if('PAGE'===r){D.page=s.trim(),D.pageValue=parseFloat(s.replace(/^.*=/,'')),D.pageSymbol=D.page.replace(/[=].*/,'');var I=A.symbol.indexOf(D.pageSymbol),J='';A.units&&A.units[I]&&(J=A.units[I]),B.indirectFrequency&&'PPM'!==J&&(D.pageValue/=B.indirectFrequency)}else'RETENTIONTIME'===r?D.pageValue=parseFloat(s):c(r)&&(D[b(r)]=s);r.match(h.keepRecordsRegExp)&&(B.info[r]=s.trim())}if(B.profiling&&B.profiling.push({action:'Finished parsing',time:Date.now()-z}),0<Object.keys(A).length){var K=[],L=Object.keys(A);for(u=0;u<L.length;u++){var M=L[u],N=A[M];for(v=0;v<N.length;v++)K[v]||(K[v]={}),K[v][M]=N[v]}B.ntuples=K}if(B.twoD&&y&&(l(B,h),B.profiling&&B.profiling.push({action:'Finished countour plot calculation',time:Date.now()-z}),!h.keepSpectra&&delete B.spectra),h.chromatogram&&(h.xy=!0),h.xy&&y&&0<C.length)for(u=0;u<C.length;u++)if(D=C[u],0<D.data.length)for(v=0;v<D.data.length;v++){for(var O=D.data[v],P={x:Array(O.length/2),y:Array(O.length/2)},Q=0;Q<O.length;Q+=2)P.x[Q/2]=O[Q],P.y[Q/2]=O[Q+1];D.data[v]=P}return h.chromatogram&&(1<B.spectra.length?d(B):e(B),B.profiling&&B.profiling.push({action:'Finished chromatogram calculation',time:Date.now()-z})),B.profiling&&B.profiling.push({action:'Total time',time:Date.now()-z}),B}}function c(a,b){return e||d(),new Promise(function(c){var d=Date.now()+''+Math.random();g[d]=c,e.postMessage(JSON.stringify({stamp:d,input:a,options:b}))})}function d(){var a=URL.createObjectURL(new Blob(['var getConverter ='+b.toString()+';var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };'],{type:'application/javascript'}));e=new Worker(a),URL.revokeObjectURL(a),e.addEventListener('message',function(a){var b=JSON.parse(a.data),c=b.stamp;g[c]&&g[c](b.output)})}var e,f=b(),g={};a.exports={convert:function(a,b,d){return'boolean'==typeof b&&(d=b,b={}),d?c(a,b):f(a,b)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map