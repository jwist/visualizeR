'use strict';define(['modules/default/defaultview','src/util/util','fancytree'],function(a,b){'use strict';function c(){}function d(f){var g=[];if(f.children&&f.children.length){var h=new DataObject;e(g,f.children,h)}return{fancy:g,model:h}}function e(f,g,h){for(var k,m,n=0,o=g.length;n<o;n++){if(k=g[n],0==n&&'object'==typeof k.info)for(var q,p=Object.keys(k.info),r=0;r<p.length;r++)q=p[r],h.hasOwnProperty(q)||(h[q]=k.info[q]);m={title:k.label||'Untitled node',dataObj:DataObject.check(k)},f.push(m),k.children&&k.children.length&&(m.children=[],e(m.children,k.children,h))}}return $.extend(!0,c.prototype,a,{init:function(){var g=b.getNextUniqueId();this.dom=$('<table id="'+g+'">').css({width:'100%'});var h=this.module.getConfiguration('columns')||[],k=$('<colgroup><col></col></colgroup>').appendTo(this.dom),m=$('<tr><th></th></tr>').appendTo($('<thead></thead>').appendTo(this.dom)),n=$('<tr><td></td></tr>').appendTo($('<tbody></tbody>').appendTo(this.dom)),o=[];if(this.jpathsF={},h.length)for(var p,q=0;q<h.length;q++)p=h[q],p.jpath&&(k.append($('<col'+(p.width?' width="'+p.width+'px"':'')+'></col>')),m.append('<th>'+(p.name||'')+'</th>'),n.append('<td></td>'),o.push(p.jpath),b.addjPathFunction(this.jpathsF,p.jpath));this.expand=this.module.getConfiguration('expand'),this.jpaths=o,this.module.getDomContent().html(this.dom)},inDom:function(){var g=this;this.dom.fancytree({extensions:['table'],table:{indentation:20,nodeColumnIdx:0},icon:!1,renderColumns:function(k,m){var n=m.node,o=n.data.dataObj,p=$(n.tr).find('>td'),q=g.jpaths;if(o.info)for(var r=0;r<q.length;r++)p.eq(r+1).text(g.jpathsF[q[r]](o.info))},activate:function(k,m){g.module.controller.onActivate(m.node.data.dataObj)}}),this.tree=this.dom.fancytree('getTree'),this.resolveReady()},update:{tree:function(g){var h=d(g.get());if(this.module.model._objectModel=h.model,this.tree.reload(h.fancy),'lvl1'===this.expand)for(var k=this.tree.rootNode.children,m=0;m<k.length;m++)k[m].setExpanded(!0);else'all'===this.expand&&this.tree.visit(function(n){n.setExpanded(!0)})}},blank:{tree:function(){this.tree.reload()}}}),c});
