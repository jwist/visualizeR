'use strict';define(['modules/default/defaultview','src/util/ui'],function(a,b){'use strict';function c(){}function d(j){return new Promise(function(k){function m(){q.width=r,q.height=t,q.getContext('2d').drawImage(p,0,0,r,t),n=q.toDataURL('image/png')}h||(h=$('<div/>'),$('body').append(h));var n=null;h.html(j);var o=!1,p=document.querySelector('#video'),q=document.querySelector('#canvas'),r=320,t=0;navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(u){if(g=u,i)return void f(g);if(navigator.mozGetUserMedia)p.mozSrcObject=g;else{var v=window.URL||window.webkitURL;p.src=v.createObjectURL(g)}p.play()},function(u){b.showNotification(u.message),h.dialog('close')}),p.addEventListener('canplay',function(){o||(t=p.videoHeight/(p.videoWidth/r),p.setAttribute('width',r),p.setAttribute('height',t),q.setAttribute('width',r),q.setAttribute('height',t),o=!0)},!1),i=!1,h.dialog({modal:!0,buttons:{Cancel:function(){$(this).dialog('close')},"Take Picture":function(){m(),k(n),$(this).dialog('close')}},close:function(){return g?(f(g),k(n)):k(!1)},width:400})})}function f(j){if(j){var k=j.getTracks();if(k){var n,l=!0,m=!1;try{for(var p,q,o=k[Symbol.iterator]();!(l=(p=o.next()).done);l=!0)q=p.value,q.stop()}catch(r){m=!0,n=r}finally{try{!l&&o.return&&o.return()}finally{if(m)throw n}}}}}$.extend(!0,c.prototype,a,{init:function(){var k=this,l=$('<input/>').css('display','none').attr({type:'file',multiple:!0});this.canDropOrPaste=this.module.getConfigurationCheckbox('inputOptions','allowDrop')||this.module.getConfigurationCheckbox('inputOptions','allowPaste');var m=$('<textarea>').css({position:'absolute',top:0,left:0,height:0,width:0,opacity:0}),n=this.module.getConfiguration('label');if(this.messages={default:n,drag:this.module.getConfiguration('dragoverlabel')||n,hover:this.module.getConfiguration('hoverlabel'),fileSelect:this.module.getConfiguration('fileSelectLabel')},this.$messages=$('<div class="flex-container">'),this.messageP=$('<div>').css('display','inline-block').css('font-size',this.module.getConfiguration('labelFontSize')).html(this.messages.default),this.dom=$('<div />',{class:this.canDropOrPaste?'content-zone dragdropzone':'content-zone'}).html(this.$messages).on('click mousemove',function(){m.focus()}).mouseout(function(){m.blur()}).append(m),this.module.getConfigurationCheckbox('inputOptions','allowPaste')&&m.on('paste',function(q){q.preventDefault(),q.stopPropagation(),k.module.controller.open(q.originalEvent.clipboardData)}),this.canDropOrPaste&&this.$messages.append(this.messageP),this.module.getConfigurationCheckbox('inputOptions','allowFileInput')&&this.module.getConfigurationCheckbox('inputOptions','showFileInputButton')){var o=$(`<button type="button" class="form-button blue"><i class="fa fa-file fa-lg"/>&nbsp; &nbsp; ${this.messages.fileSelect}</button>`);this.$messages.append(o),o.on('click',function(q){q.stopPropagation(),l.click()})}if(this.module.getConfigurationCheckbox('inputOptions','allowFileInput')&&this.dom.on('click',function(q){q.stopPropagation(),l.click()}),this.module.getConfigurationCheckbox('inputOptions','allowCamera')){var p=$('<button type="button" class="form-button red"><i class="fa fa-camera fa-lg"/>&nbsp; &nbsp; Take picture</button>');this.$messages.append(p),p.on('click',function(q){q.stopPropagation(),d($('<video id="video"></video><canvas id="canvas" style="display:none;"></canvas>')).then(function(r){!r||r&&k.module.controller.openPhoto(r)})})}l.on('change',function(q){k.module.controller.open(k.module.controller.emulDataTransfer(q))}),l.on('load',function(){}),this.module.getDomContent().html(this.dom)},inDom:function(){var k=this,l=this.dom.get(0),m=0;this.module.getConfigurationCheckbox('inputOptions','allowDrop')&&(l.addEventListener('dragenter',function(n){m++,n.stopPropagation(),n.preventDefault(),1==m&&(k.messageP.html(k.messages.drag),k.dom.addClass('dragdrop-over'))}),l.addEventListener('dragover',function(n){n.stopPropagation(),n.preventDefault()}),l.addEventListener('dragleave',function(n){m--,n.stopPropagation(),n.preventDefault(),m||(k.messageP.html(k.messages.default),k.dom.removeClass('dragdrop-over'))}),l.addEventListener('drop',function(n){m=0,n.stopPropagation(),n.preventDefault(),k.dom.removeClass('dragdrop-over'),k.messageP.html(k.messages.default),k.module.controller.open(n.dataTransfer)})),this.module.getConfigurationCheckbox('inputOptions','allowPaste')&&(l.addEventListener('mouseleave',function(n){n.stopPropagation(),n.preventDefault(),k.messageP.html(k.messages.default),k.dom.removeClass('dragdrop-over')}),l.addEventListener('mouseenter',function(n){n.stopPropagation(),n.preventDefault(),k.messageP.html(k.messages.hover),k.dom.addClass('dragdrop-over')})),this.resolveReady()}});var g,h,i=!0;return c});
