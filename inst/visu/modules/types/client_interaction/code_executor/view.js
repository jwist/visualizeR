'use strict';define(['modules/default/defaultview','src/util/util','ace/ace','src/util/context','jquery','forms/button'],function(a,c,d,e,f,g){'use strict';function h(){}return f.extend(!0,h.prototype,a),h.prototype.init=function(){this._id=c.getNextUniqueId(),this._code='';var i=this.table=f('<table>').css({height:'100%',width:'100%',bottom:0}),j=f('<tr>').appendTo(i).css('height','auto');this.editorRow=j,this.buttonRow=f('<tr>').appendTo(i).css('height','30px'),this.editorCell=f('<td>').css('height','100%').appendTo(j),this.buttonCell=f('<td>').appendTo(this.buttonRow).css('text-align','center'),this._input={},this.buttons=[],this.module.getDomContent().html(i)},h.prototype.inDom=function(){var i=this,j=this.module.getConfiguration('script')||'';if(this._code=j,this.module.getConfigurationCheckbox('display','editor')?(f('<div id="'+this._id+'"></div>').css('height','100%').css('width','100%').appendTo(this.editorCell),this.editor=d.edit(this._id),this.editor.$blockScrolling=Infinity,this.editor.getSession().setOption('useWorker',!1),this.editor.getSession().setMode('./mode/javascript'),this.editor.setValue(j,-1),this.editor.getSession().on('change',this.editorChanged.bind(this)),this.table.css({height:'100%'})):this.table.css({height:'auto'}),this.module.getConfigurationCheckbox('display','buttons')){var k=this.module.getConfiguration('buttons');k?k.forEach(function(l,m){var n=i.module.controller.onButtonClick.bind(i.module.controller,l.name),o=new g(l.label,n,{color:'Grey',disabled:!1});o.name=l.name,l.hide&&-1<l.hide.indexOf('hide')&&o.hide(),i.buttonCell.append(o.render()),i.buttons.push(o),0===m&&i.editor&&i.editor.commands.addCommand({name:'run',bindKey:{win:'Ctrl-Return',mac:'Command-Return'},exec:n})}):this.buttonRow.css('height',0)}else this.buttonRow.css('height',0);this.resolveReady()},h.prototype.disableButtons=function(){this.buttons.forEach((i)=>i.disable())},h.prototype.enableButtons=function(){this.buttons.forEach((i)=>{i.disabledFromScript||i.enable()})},h.prototype.onResize=function(){this.editor&&(30>this.height-this.buttonRow.height()?this.editorCell.hide():(this.editorCell.show(),this.editor.resize()))},h.prototype.editorChanged=function(){var i=this.editor.getValue();this._code=i,this.module.definition.configuration.groups.group[0].script[0]=i},h.prototype.blank.inputValue=function(i){this._input[i]=null},h.prototype.update.inputValue=function(i,j){this._input[j]=i,this.module.controller.onVariableIn(j)},h.prototype.onActionReceive.execute=function(i,j){this.module.controller.onActionIn(j,i)},h});
