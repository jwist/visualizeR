'use strict';define(['jquery','lodash','modules/default/defaultview','src/util/util','ace/ace','src/util/context','src/util/aceHelper'],function(a,b,c,d,e,f,g){'use strict';function h(){this._id=d.getNextUniqueId(),this._code='',this._data=null}return a.extend(!0,h.prototype,c,{init(){var i=this.table=a('<table>').css({height:'100%',width:'100%'}),j=a('<tr>').appendTo(i).css('height','auto');this.buttonRow=a('<tr>').appendTo(i).css('height','30px'),this.editorCell=a('<td>').css('height','100%').appendTo(j),this.buttonCell=a('<td>').appendTo(this.buttonRow).css('text-align','center');var k=this.module.getConfiguration('debouncing');this.editorChangedDebounced=0<k?b.debounce(this.editorChanged.bind(this,!1),k):-1===k?this.editorChanged.bind(this,!0):this.editorChanged.bind(this,!1),this.module.getDomContent().html(i)},inDom(){var i=(this.module.getConfiguration('script')||'')+'';if(this.setCode(i,!1,!0),this.module.getConfigurationCheckbox('iseditable','editable')){this.editable=!0,a(`<div id="${this._id}"></div>`).css('height','100%').css('width','100%').appendTo(this.editorCell),this.editor=e.edit(this._id);var j='./mode/'+this.module.getConfiguration('mode');g.applyConfig(this.module,this.editor),this.editor.$blockScrolling=Infinity,this.editor.getSession().setOption('useWorker',!1),this.editor.getSession().setMode(j),this.editor.setValue(i,-1),this.editor.getSession().on('change',this.editorChangedDebounced)}this.module.getConfigurationCheckbox('hasButton','button')?this.buttonCell.append(a('<button>'+this.module.getConfiguration('btnvalue')+'</button>').addClass('form-button').on('click',()=>this.module.controller.onButtonClick(this.getCode()))):this.buttonRow.remove(),this.resolveReady()},blank:{data(){this._data=null,this.setCode('',!1,!0),this.editable&&this.editor.setValue('')}},update:{data(i){this._data=i;var j=i.get()+'';if(this.setCode(j,!1,!0),this.editable){var k=this.editor.getValue();if(j===k)return;this.editor.setValue(j),this.editor.scrollToLine(0),this.editor.clearSelection()}}},editorChanged(i){this.setCode(this.editor.getValue(),i,!1)},onResize(){this.editor&&this.editor.resize()},setCode(i,j,k){var l=this._code;l===i||(this._code=i,this.module.getConfigurationCheckbox('storeOnChange','store')&&this.module.definition.configuration.groups&&(this.module.definition.configuration.groups.group[0].script[0]=i),!j&&this.module.controller.onEditorChanged(i,k))},getCode(){return this._code}}),h});
