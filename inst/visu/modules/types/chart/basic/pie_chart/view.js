'use strict';define(['modules/default/defaultview','src/util/datatraversing','src/util/api','src/util/util','lib/flot/jquery.flot','lib/flot/jquery.flot.pie'],function(a,b,c,d){'use strict';function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<div id="'+this._id+'"></div>').css('height','100%').css('width','100%'),this.module.getDomContent().html(this.dom)),this.dom&&this.dom.empty(),this._flot&&delete this._flot,this.loadedData=$.Deferred(),this.updateOptions(),this._data=[],this.resolveReady()},onResize:function(){var g=this;this.loadedData.done(function(){g._plot=$.plot('#'+g._id,g._data,g._options),$('#'+g._id).bind('plotclick',function(j,k,l){}),$('#'+g._id).bind('plothover',function(j,k,l){l?g.module.controller.elementHover(g._data[l.seriesIndex]):g.module.controller.elementOut()}),c.killHighlight(g.module.getId());for(var h=0;h<g._data.length;h++)g._data[h]._highlight&&function(j){c.listenHighlight(g._data[j],function(k){k?g._plot.highlight(0,j):g._plot.unhighlight(0,j)},!1,g.module.getId())}(h)})},update:{chart:function(g){g&&g.value&&(this._convertChartToData(g.get()),this.loadedData.resolve(),this.onResize())},yArray:function(g){this._data=g.get(),this.loadedData.resolve(),this.onResize()}},_convertChartToData:function(g){var h=this;this._data=[];var j=this;if(Array.isArray(g.data)&&g.data[0]&&Array.isArray(g.data[0].y))for(var k=g.data[0].y,l=g.data[0]._highlight,m=g.data[0].info,n=function(q){h._data[q]={data:k[q]},Array.isArray(l)&&l.length>q&&(Array.isArray(l[q])?h._data[q]._highlight=l[q]:h._data[q]._highlight=[l[q]]),Array.isArray(m)&&m.length>q&&b.getValueFromJPath(m[q],'element.name').done(function(r){j._data[q].label=r,j._data[q].info=m[q]})},o=0;o<k.length;o++)n(o)},updateOptions(){this._options={grid:{clickable:!0,hoverable:!0},series:{pie:{show:!0}}},this._options.test=this.module.getConfiguration('nodeSize')||1}}),e});
