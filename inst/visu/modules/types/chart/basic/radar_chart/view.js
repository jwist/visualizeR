'use strict';define(['modules/default/defaultview','src/util/datatraversing','src/util/api','src/util/util','lib/dhtmlxchart/dhtmlxchart'],function(a,b,c,d){'use strict';function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<div style="height: 100%;width: 100%" id="'+this._id+'"></div>'),this.module.getDomContent().html(this.dom)),this._data=[],this.resolveReady()},onResize:function(){this._redraw()},update:{chart:function(g){this.value=g.get(),this._redraw()}},blank:{chart:function(){this.dom&&this.dom.empty()}},_redraw:function(){if(this.value){this.dom&&this.dom.empty();var g=this._convertChartToData(this.value);this.createChart(this.value),this._radar.parse(g,'json');var h=this;this._radar.attachEvent('onMouseMove',function(k,l){return g.forEach(function(n){if(n.id==k){var o=n;'d'==l.toElement.outerHTML[l.toElement.outerHTML.length-3]?h.module.controller.elementHover(o._highlight[0]):h.module.controller.elementHover(o._highlight[l.toElement.outerHTML[l.toElement.outerHTML.length-3]])}}),!0}),this._radar.attachEvent('onMouseOut',function(){h.module.controller.elementOut()})}},_convertChartToData:function(g){var h=[];if(g&&Array.isArray(g.data))for(var k=0;k<g.data[0].x.length;k++){h[k]={},h[k].xunit=g.data[0].x[k],h[k]._highlight=[];for(var m,l=0;l<g.data.length;l++)m='serie'+l,h[k][m]=g.data[l].y[k],g.data[l]._highlight&&g.data[l]._highlight[k]&&h[k]._highlight.push({name:m,_highlight:g.data[l]._highlight[k]})}return h},getRandomColor:function(g,h){return'hsla('+360/g*h+',100%,50%,0.3)'},createChart:function(g){var k=this.module.getConfiguration;switch(k('preference')){case'radar':g.data[0].color||(g.data[0].color=this.getRandomColor(g.data.length,0));var l={view:'radar',container:this._id,alpha:0.2,value:'#serie0#',disableLines:k('line'),disableItems:k('point'),color:g.data[0].color,fill:g.data[0].color,line:{color:g.data[0].color,width:1},xAxis:{template:'#xunit#'},yAxis:{lineShape:k('lineshape'),start:k('start'),end:k('end'),step:k('step')}};this._radar=new dhtmlXChart(l);for(var m=[],n=0;n<g.data.length;n++)0!=n&&(!g.data[n].color&&(g.data[n].color=this.getRandomColor(g.data.length,n)),this._radar.addSeries({value:'#serie'+n+'#',fill:g.data[n].color,disableLines:k('line'),line:{color:g.data[n].color,width:1}})),m.push({text:g.data[n].serieLabel,color:g.data[n].color});break;case'pie':var l={view:k('pie'),container:this._id,radius:220,value:'#serie0#',color:g.data[0].color,pieInnerText:'<b>#xunit#</b>'};this._radar=new dhtmlXChart(l);}if('true'==k('showlegend'))switch(k('legendalign')){case'top-left':this._radar.define('legend',{width:120,align:'left',valign:'top',marker:{type:k('legendmarker'),width:15},values:m});break;case'top-right':this._radar.define('legend',{width:120,align:'right',valign:'top',marker:{type:k('legendmarker'),width:15},values:m});break;case'bottom-left':this._radar.define('legend',{width:120,align:'left',valign:'bottom',marker:{type:k('legendmarker'),width:15},values:m});break;case'bottom-right':this._radar.define('legend',{width:120,align:'right',valign:'bottom',marker:{type:k('legendmarker'),width:15},values:m});}}}),e});
