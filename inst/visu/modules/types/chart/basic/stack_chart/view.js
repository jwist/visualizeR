'use strict';define(['modules/default/defaultview','src/util/datatraversing','src/util/api','src/util/util','lib/flot/jquery.flot'],function(a,b,c,d){'use strict';function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom&&this.dom.empty(),this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<p id="choices'+this._id+'" style="float:right; width:15%;"><br></p><div style="height: 100%;width: 80%" id="'+this._id+'"></div>'),this.module.getDomContent().html(this.dom)),this._flot&&delete this._flot,this.loadedData=$.Deferred(),this._data=[];var h,k,g=this.module.getConfiguration;this.updateOptions(g,h,k),this.resolveReady()},onResize:function(){var g=this;this.loadedData.done(function(){this._plot=g.plot(g._id,g._data,g._options);var h=$('#choices'+g._id);h.empty(),$.each(g._data,function(k,l){h.append('<br/><input type=\'checkbox\' name=\''+k+'\' checked=\'checked\' id=\'id'+k+'\'></input><label for=\'id'+k+'\'>'+l.label+'</label>')}),h.find('input').bind('click',function(){g.plotAccordingToChoices(h,g._id)})})},update:{chart:function(g){var h=this.module.getConfiguration;this._convertChartToData(g.get().data);var k=g.get().axis,l=g.get().data[0].x;this.updateOptions(h,k,l),this._plot=this.plot(this._id,this._data,this._options),this.loadedData.resolve()}},_convertChartToData:function(g){if(this._data=[],Array.isArray(g)&&g&&Array.isArray(g.x))for(var h=0;h<g.length;h++){for(var k=g[h].x,l=g[h].y,m=g[h]._highlight,n=g[h].serieLabel,o=g[h].info[0].name,p=[],q=0;q<l.length;q++)$.isNumeric(k[q])?p.push({0:k[q],1:l[q],_highlight:m[q]}):p.push({0:q,1:l[q],_highlight:m[q]});this._data[h]={data:p,info:n,label:o}}},updateOptions:function(g,h,k){var l=null,m=null,n=null,o=null,p=null,q=null,r=null,t=null;if(void 0!=h){if(l=h[0].type,m=h[1].type,p=h[0].max,q=h[1].max,n=h[0].min,o=h[1].min,Array.isArray(k)){for(var v=[],w=0;w<k.length;w++)v.push([w,k[w]]);r=v}if(Array.isArray(h[1].unit)){for(v=[],w=0;w<h[1].unit.length;w++)v.push([w,h[1].unit[w]]);t=v}}var z=!1,A=!1,B=!1,C=g('stack'),D=g('barWidth'),E=g('xLabel'),F=g('yLabel'),G=g('xLabelHeight'),H=g('xLabelWidth'),I=g('yLabelHeight'),J=g('yLabelWidth');switch(g('preference')){case'Lines With Steps':z=!0,B=!0;break;case'Bars':A=!0;break;case'Lines':B=!0;}this._options={xaxis:{show:!0,position:l,min:n,max:p,tickFormatter:function(L,M){return L<M.max?L.toFixed(2):E},ticks:r,labelWidth:H,labelHeight:G},yaxis:{position:m,min:o,max:q,ticks:t,tickFormatter:function(L,M){return L<M.max?L.toFixed(2):F},labelWidth:J,labelHeight:I},grid:{clickable:!0,hoverable:!0},series:{stack:C,lines:{show:B,fill:g('fill'),steps:z},bars:{show:A,barWidth:D}}}},plot:function(g,h,k){var l=this;this._plot=$.plot('#'+g,h,k),$('#'+g).bind('plotclick',function(m){m.preventDefault()}),$('#'+g).bind('plothover',function(m,n,o){o?l.module.controller.elementHover(l._data[o.seriesIndex].data[o.dataIndex]):l.module.controller.elementOut()})},plotAccordingToChoices:function(g,h){var k=this,l=[];g.find('input:checked').each(function(){var m=$(this).attr('name');m&&k._data[m]&&l.push(k._data[m])}),0<l.length&&this.plot(h,l,k._options)}}),e});
