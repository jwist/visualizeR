'use strict';define(['modules/default/defaultview','src/util/util','lib/d3/d3.phylogram','src/util/api','src/util/ui','src/util/tree'],function(b,c,d,e,f,g){'use strict';function h(){}function j(k,l,m){Array.isArray(m)&&(k[l]=m)}return $.extend(!0,h.prototype,b,{init:function(){this._id=c.getNextUniqueId(),this.selectorId='#'+this._id,this.chart=null,this.currentHighlightId=null,this.dom=f.getSafeElement('div').attr('id',this._id),this.module.getDomContent().html(this.dom),this.resolveReady()},blank:function(){this.dom.empty()},getIdHash:function(l){if(l.id&&(this._idHash[l.id]=l),Array.isArray(l.children))for(var m=0;m<l.children.length;m++)this.getIdHash(l.children[m])},update:{tree:function(l){this._value=l.get(),this.updateTree()},newTree:function(l){this._tree=l.get(),this.doAnnotation()},data:function(l){this._data=l.get(),this.doAnnotation()}},doAnnotation:function(){if(this._tree){var l=this.getOptions();this._value=g.annotateTree(this._tree,this._data||[],l),this.updateTree()}},updateTree:function(){this._idHash=[],this.getIdHash(this._value),e.killHighlight(this._id),this.drawPhylogram()},getOptions:function(){var l={},m=this.module.getConfiguration;return j(l,'$color',m('jpathColor')),j(l,'label',m('jpathLabel')),l},drawPhylogram:function(){if(this._value){var n=this._value,o=this;this.dom.empty();var p=this.module.getConfigurationCheckbox('d3check','skipBranchLengthScaling');d.phylogram.build(this.selectorId,n,{height:o.height,width:o.width,skipBranchLengthScaling:p,skipTicks:!1,skipLabels:this.module.getConfigurationCheckbox('d3check','skipLabels'),labelDx:this.module.getConfiguration('labelDx'),labelDy:this.module.getConfiguration('labelDy'),labelSize:this.module.getConfiguration('labelSize'),children:function(s){return s.children},callbackMouseOverLeaf:function(s){o.module.controller.mouseOverLeaf(s),e.highlight(s.data,1)},callbackMouseOutLeaf:function(s){o.module.controller.mouseOutLeaf(s),e.highlight(s.data,0)},callbackClickLeaf:function(s){o.module.controller.clickLeaf(s)},callbackMouseOverBranch:function(s){o.module.controller.mouseOverBranch(s.target)},callbackMouseOutBranch:function(s){o.module.controller.mouseOutBranch(s.target)},callbackClickBranch:function(s){o.module.controller.clickBranch(s.target)}});var q=d.selectAll(this.selectorId+' .leaf');q.each(function(r){(function(s,t){s.data&&s.data._highlight&&e.listenHighlight(s.data,function(u){var w=t.select('circle');w.attr('fill',function(x){return x.data&&x.data.$color?x.data.$color:u?'#f5f48d':'grey'}),w.attr('r',u?9:4.5)},!1,o._id)})(r,d.select(this))}),d.selectAll(this.selectorId+' .link').each(function(){d.select(this).attr('stroke-width',o.module.getConfiguration('branchWidth')+'px'||'5px')})}},onResize:function(){this.drawPhylogram()}}),h});
