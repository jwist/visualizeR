'use strict';var _Mathsqrt=Math.sqrt;THREE.TrackballControls=function(a,b){function c(D){!1!==m.enabled&&(window.removeEventListener('keydown',c),q=p,p!==n.NONE||(D.keyCode!==m.keys[n.ROTATE]||m.noRotate?D.keyCode!==m.keys[n.ZOOM]||m.noZoom?D.keyCode!==m.keys[n.PAN]||m.noPan||(p=n.PAN):p=n.ZOOM:p=n.ROTATE))}function g(D){!1===m.enabled||(D.preventDefault(),D.stopPropagation(),p!==n.ROTATE||m.noRotate?p!==n.ZOOM||m.noZoom?p===n.PAN&&!m.noPan&&(z=m.getMouseOnScreen(D.pageX,D.pageY,z)):v=m.getMouseOnScreen(D.pageX,D.pageY,v):t=m.getMouseProjectionOnBall(D.pageX,D.pageY,t))}function h(D){!1===m.enabled||(D.preventDefault(),D.stopPropagation(),p=n.NONE,document.removeEventListener('mousemove',g),document.removeEventListener('mouseup',h),m.dispatchEvent(C))}function i(D){if(!1!==m.enabled){D.preventDefault(),D.stopPropagation();var E=0;D.wheelDelta?E=D.wheelDelta/40:D.detail&&(E=-D.detail/3),u.y+=0.01*E,m.dispatchEvent(B),m.dispatchEvent(C)}}var m=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=b===void 0?document:b,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=0.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=0.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3;var o=new THREE.Vector3,p=n.NONE,q=n.NONE,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector2,v=new THREE.Vector2,w=0,x=0,y=new THREE.Vector2,z=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var A={type:'change'},B={type:'start'},C={type:'end'};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{this.screen=this.domElement.getBoundingClientRect();var D=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-D.clientLeft,this.screen.top+=window.pageYOffset-D.clientTop}},this.handleEvent=function(D){'function'==typeof this[D.type]&&this[D.type](D)},this.getMouseOnScreen=function(D,E,F){return(F||new THREE.Vector2).set((D-m.screen.left)/m.screen.width,(E-m.screen.top)/m.screen.height)},this.getMouseProjectionOnBall=function(){var D=new THREE.Vector3;return function(E,F,G){var H=new THREE.Vector3((E-0.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(0.5*m.screen.height+m.screen.top-F)/(.5*m.screen.height),0),I=H.length();return m.noRoll?I<Math.SQRT1_2?H.z=_Mathsqrt(1-I*I):H.z=.5/I:1<I?H.normalize():H.z=_Mathsqrt(1-I*I),r.copy(m.object.position).sub(m.target),G.copy(m.object.up).setLength(H.y),G.add(D.copy(m.object.up).cross(r).setLength(H.x)),G.add(r.setLength(H.z)),G}}(),this.rotateCamera=function(){var D=new THREE.Vector3,E=new THREE.Quaternion;return function(){var F=Math.acos(s.dot(t)/s.length()/t.length());F&&(D.crossVectors(s,t).normalize(),F*=m.rotateSpeed,E.setFromAxisAngle(D,-F),r.applyQuaternion(E),m.object.up.applyQuaternion(E),t.applyQuaternion(E),m.staticMoving?s.copy(t):(E.setFromAxisAngle(D,F*(m.dynamicDampingFactor-1)),s.applyQuaternion(E)))}}(),this.zoomCamera=function(){if(p===n.TOUCH_ZOOM){var D=w/x;w=x,r.multiplyScalar(D)}else{var D=1+(v.y-u.y)*m.zoomSpeed;1!=D&&0<D&&(r.multiplyScalar(D),m.staticMoving?u.copy(v):u.y+=(v.y-u.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var D=new THREE.Vector2,E=new THREE.Vector3,F=new THREE.Vector3;return function(){D.copy(z).sub(y),D.lengthSq()&&(D.multiplyScalar(r.length()*m.panSpeed),F.copy(r).cross(m.object.up).setLength(D.x),F.add(E.copy(m.object.up).setLength(D.y)),m.object.position.add(F),m.target.add(F),m.staticMoving?y.copy(z):y.add(D.subVectors(z,y).multiplyScalar(m.dynamicDampingFactor)))}}(),this.checkDistances=function(){m.noZoom&&m.noPan||(r.lengthSq()>m.maxDistance*m.maxDistance&&m.object.position.addVectors(m.target,r.setLength(m.maxDistance)),r.lengthSq()<m.minDistance*m.minDistance&&m.object.position.addVectors(m.target,r.setLength(m.minDistance)))},this.update=function(){r.subVectors(m.object.position,m.target),m.noRotate||m.rotateCamera(),m.noZoom||m.zoomCamera(),m.noPan||m.panCamera(),m.object.position.addVectors(m.target,r),m.checkDistances(),m.object.lookAt(m.target),0<o.distanceToSquared(m.object.position)&&(m.dispatchEvent(A),o.copy(m.object.position))},this.reset=function(){p=n.NONE,q=n.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),r.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(A),o.copy(m.object.position)},this.domElement.addEventListener('contextmenu',function(D){D.preventDefault()},!1),this.domElement.addEventListener('mousedown',function(D){!1===m.enabled||(D.preventDefault(),D.stopPropagation(),p===n.NONE&&(p=D.button),p!==n.ROTATE||m.noRotate?p!==n.ZOOM||m.noZoom?p===n.PAN&&!m.noPan&&(y=m.getMouseOnScreen(D.pageX,D.pageY,y),z.copy(y)):(u=m.getMouseOnScreen(D.pageX,D.pageY,u),v.copy(u)):(s=m.getMouseProjectionOnBall(D.pageX,D.pageY,s),t.copy(s)),document.addEventListener('mousemove',g,!1),document.addEventListener('mouseup',h,!1),m.dispatchEvent(B))},!1),this.domElement.addEventListener('mousewheel',i,!1),this.domElement.addEventListener('DOMMouseScroll',i,!1),this.domElement.addEventListener('touchstart',function(D){if(!1!==m.enabled){switch(D.touches.length){case 1:p=n.TOUCH_ROTATE,t.copy(m.getMouseProjectionOnBall(D.touches[0].pageX,D.touches[0].pageY,s));break;case 2:p=n.TOUCH_ZOOM;var E=D.touches[0].pageX-D.touches[1].pageX,F=D.touches[0].pageY-D.touches[1].pageY;x=w=_Mathsqrt(E*E+F*F);break;case 3:p=n.TOUCH_PAN,z.copy(m.getMouseOnScreen(D.touches[0].pageX,D.touches[0].pageY,y));break;default:p=n.NONE;}m.dispatchEvent(B)}},!1),this.domElement.addEventListener('touchend',function(D){if(!1!==m.enabled){switch(D.touches.length){case 1:s.copy(m.getMouseProjectionOnBall(D.touches[0].pageX,D.touches[0].pageY,t));break;case 2:w=x=0;break;case 3:y.copy(m.getMouseOnScreen(D.touches[0].pageX,D.touches[0].pageY,z));}p=n.NONE,m.dispatchEvent(C)}},!1),this.domElement.addEventListener('touchmove',function(D){if(!1!==m.enabled)switch(D.preventDefault(),D.stopPropagation(),D.touches.length){case 1:t=m.getMouseProjectionOnBall(D.touches[0].pageX,D.touches[0].pageY,t);break;case 2:var E=D.touches[0].pageX-D.touches[1].pageX,F=D.touches[0].pageY-D.touches[1].pageY;x=_Mathsqrt(E*E+F*F);break;case 3:z=m.getMouseOnScreen(D.touches[0].pageX,D.touches[0].pageY,z);break;default:p=n.NONE;}},!1),window.addEventListener('keydown',c,!1),window.addEventListener('keyup',function(){!1===m.enabled||(p=q,window.addEventListener('keydown',c,!1))},!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);
