'use strict';var _Mathfloor=Math.floor;define(['jquery','modules/default/defaultcontroller','lodash'],function(a,b,c){'use strict';function d(){}function f(g,h){return function(k){var m=g.getMatrixElementFromEvent(k);if(m){var n=m[1],o=m[0];g.setVarFromEvent(h,'row','matrix',['xLabel',n]),g.setVarFromEvent(h,'col','matrix',['yLabel',o]);var p=[n,o],q=g.module.getDataFromRel('matrix').get();if(q.data&&(q=q.data,p.unshift('data')),g.setVarFromEvent(h,'intersect','matrix',p),'undefined'!=typeof q[n]){g.createDataFromEvent(h,'point',{row:n,column:o,value:q[n][o]}),g.createDataFromEvent(h,'fullRow',q[n].slice());for(var r=q.length,s=Array(r),t=0;t<r;t++)s[t]=q[t][o];g.createDataFromEvent(h,'fullCol',s)}}}}return a.extend(!0,d.prototype,b),d.prototype.moduleInformation={name:'Matrix display',description:'Display an array of array as a colored matrix',author:'Norman Pellet',date:'24.12.2013',license:'MIT',cssClass:'canvas_matrix'},d.prototype.getMatrixElementFromEvent=function(g){var h;if(!(h=this.module.getDataFromRel('matrix')))return!1;var j=this.module.view.getPxPerCell(),k=this.module.view.getXYShift();g.offsetX=g.offsetX||g.pageX-a(g.target).offset().left,g.offsetY=g.offsetY||g.pageY-a(g.target).offset().top;var m=_Mathfloor((g.offsetX-k.x)/j),n=_Mathfloor((g.offsetY-k.y)/j),o=h.get();return o=o.data?o.data:o,!o||!o[0]||0>m||0>n||n>o.length||m>o[0].length?!1:[m,n]},d.prototype.initEvents=function(){var g=a(this.module.getDomContent());g.on('mousemove','canvas',c.debounce(f(this,'onPixelHover'),25)),g.on('click','canvas',f(this,'onPixelClick'))},d.prototype.references={row:{label:'Row index'},fullRow:{label:'Full row'},col:{label:'Column index'},fullCol:{label:'Full column'},intersect:{label:'Intersection value'},point:{label:'Coordinates and value'},matrix:{label:'Matrix',description:'A 2D array representing the matrix',type:['matrix','object','array']}},d.prototype.variablesIn=['matrix'],d.prototype.events={onPixelHover:{label:'Hover on a pixel',description:'When the mouses moves over a new pixel of the data matrix',refVariable:['row','col','intersect','point','fullRow','fullCol']},onPixelClick:{label:'Click on a pixel',description:'When the users click on any pixel',refVariable:['row','col','intersect','point','fullRow','fullCol']}},d.prototype.configurationStructure=function(){return{groups:{group:{options:{type:'list'},fields:{highcontrast:{default:'true',type:'checkbox',title:'Contrast',options:{true:'Take data min/max as boundaries'}},color:{type:'color',title:'Color',multiple:!0}}}}}},d.prototype.configAliases={colors:['groups','group',0,'color'],highContrast:['groups','group',0,'highcontrast',0,0]},d});
