'use strict';define(['jquery','modules/default/defaultview','jsgraph','src/util/color','chroma'],function(c,d,e,f,g){'use strict';function h(){}function k(o,p,q,r,s,u,v){var A,B,w=g(q),z=g(r);if('fixed'===o)return B=w.css(),function(){return B};if('range'===o)return A=g.scale([w,z]).mode(p),function(F){return A(F[s]).css()};if('inter'===o){var C=m(q,r),D=(q[3]+r[3])/2;return function(F){return g([C[0](F[s]),C[1](F[u]),C[2](F[v]),D]).css()}}}function m(o,p){return[n(o[0],p[0]),n(o[1],p[1]),n(o[2],p[2])]}function n(o,p){return o=+o,p=+p,function(r){return o*(1-r)+p*r}}return c.extend(!0,h.prototype,d,{init(){this.dom=document.createElement('div'),this.dom.style.height='100%',this.dom.style.width='100%',this.dom.style.overflow='hidden',this.module.getDomContent().html(this.dom),this.series={},this.datasetInfo={}},inDom(){var o={primaryGrid:!1,secondaryGrid:!1};this.graph=new e(this.dom,{close:{left:!1,right:!1,top:!1,bottom:!1},plugins:{zoom:{zoomMode:'xy'},drag:{}},pluginAction:{zoom:{shift:!1,ctrl:!1},drag:{shift:!0,ctrl:!1}},dblclick:{type:'plugin',plugin:'zoom',options:{mode:'total'}}},{bottom:[o],left:[o]});var p=this;this.graph.on('shapeMouseOver',function(q){p.module.controller.onCellHover(q.getData())}),this.graph.getXAxis().hide().setAxisDataSpacing(0,0),this.graph.getYAxis().hide().setAxisDataSpacing(0,0),this.resolveReady()},blank:{model(){this.graph.removeShapes()},dataset(o){this.series[o]&&(this.series[o].kill(),delete this.series[o]),this.datasetInfo[o]&&(this.datasetInfo[o]=null)}},update:{model(o){if('SOM'===o.get('name')+''){var u,p=o.get('data'),q=p.length,r=p[0].length,s=this.graph,v=this.module.getConfiguration,w=v('bgField1'),z=v('bgField2'),A=v('bgField3'),B=o.options.fields;if(Array.isArray(B))for(u=0;u<B.length;u++)B[u].name===w&&(w=u),B[u].name===z&&(z=u),B[u].name===A&&(A=u);var C=k(v('bgType'),v('bgSpace'),v('bgColor1'),v('bgColor2'),w,z,A);for(s.getXAxis().forceMin(0).forceMax(q),s.getYAxis().forceMin(0).forceMax(r),u=0;u<q;u++)for(var E,D=0;D<r;D++)E=s.newShape('rect',{position:[{x:u,y:D},{x:u+1,y:D+1}],fillColor:C(p[u][D]),layer:1,info:p[u][D]}),E.draw(),E.redraw();this.redraw()}},dataset(o,p){var q,r,u,s=this.module.getConfiguration('datasets');if(s)for(q=0;q<s.length;q++)if(s[q].groups.group[0].dataset[0]===p){u=s[q].groups.group[0];break}if(!u)r=k('fixed',null,[255,0,0,1]);else switch(u.colorType[0]){case'fixed':r=k('fixed',null,u.color1[0]);break;case'jpath':r=function(F){return g(DataObject.check(F).getChildSync(u.jpath1[0])+'').css()};}var C,v=this,w=o.getChildSync(['data','0']),z=w.x.length,A=Array(2*z),B=Array(z);for(q=0;q<z;q++)A[2*q]=w.x[q],A[2*q+1]=w.y[q],C=r(w.info[q]),B[q]={fill:C};var D=this.series[p]=this.graph.newSerie(p,{layer:2},'scatter').autoAxis().setData(A).setStyle({shape:'circle',r:3,stroke:'black'},B).setStyle({r:6},'selected');w.info&&(D.on('mouseover',function(E){D.selectPoint(E),v.module.controller.onElementHover(w.x[E],w.y[E],w.info[E])}),D.on('mouseout',function(E){D.selectPoint(E,!1)})),this.redraw()}},onResize(o,p){this.graph&&(this.graph.resize(o,p),this.redraw())},redraw(){this.graph.redraw(),this.graph.autoscaleAxes(),this.graph.drawSeries()}}),h});
