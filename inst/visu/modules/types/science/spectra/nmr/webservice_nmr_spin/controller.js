'use strict';define(['jquery','modules/default/defaultcontroller','nmr-simulation'],function(a,b,c){'use strict';function d(){}function e(h,k,l){for(var m=Array(l),o=h,p=0;p<l;p++)m[p]=o,o+=(k-h)/l;return m}a.extend(!0,d.prototype,b),d.prototype.moduleInformation={name:'NMR spin system simulation',description:'Allows to enter coupling constant',author:'Luc Patiny',date:'30.12.2013',license:'MIT',cssClass:'webservice_nmr_spin'};var f=/^delta_(\d+)/,g=/^coupling_(\d+)_(\d+)/;return d.prototype.doAnalysis=function(){var n,o,p,q,h=this.module.view.system.serializeArray(),k=[],l=[],m={};for(p=0;p<h.length;p++){if(isNaN(h[p].value))throw new Error('not a number');n=h[p].name,(o=f.exec(n))&&(k[o[1]]=+h[p].value,l[o[1]]=2)}var r=Array(k.length);for(p=0;p<k.length;p++)for(r[p]=Array(k.length),q=0;q<k.length;q++)r[p][q]=0;for(p=0;p<h.length;p++)n=h[p].name,f.test(n)||((o=g.exec(n))?(r[o[1]][o[2]]=+h[p].value,r[o[2]][o[1]]=+h[p].value):m[n]=+h[p].value);var s=new c.SpinSystem(k,r,l),t=c.simulate1D(s,m),u={data:[{x:e(m.from,m.to,m.nbPoints),y:t}]};this.createDataFromEvent('onSearchReturn','results',u)},d.prototype.references={results:{label:'Spectrum'}},d.prototype.events={onSearchReturn:{label:'An analysis has been completed',refVariable:['results']}},d.prototype.configurationStructure=function(){return{groups:{group:{options:{type:'list'},fields:{systemSize:{type:'combo',title:'Spin system',default:'2',options:[{key:'2',title:'AB'},{key:'3',title:'ABC'},{key:'4',title:'ABCD'},{key:'5',title:'ABCDE'},{key:'6',title:'ABCDEF'}]},button:{type:'checkbox',title:'Process button',default:'button',options:{button:''}},buttonlabel:{type:'text',default:'Calculate',title:'Button text'},buttonlabel_exec:{type:'text',default:'Calculating',title:'Button text (executing)'},onloadanalysis:{type:'checkbox',title:'Make one process on load',default:'onload',options:{onload:''}}}}}}},d.prototype.configAliases={button:['groups','group',0,'button',0],systemSize:['groups','group',0,'systemSize'],buttonlabel:['groups','group',0,'buttonlabel',0],buttonlabel_exec:['groups','group',0,'buttonlabel_exec',0],onloadanalysis:['groups','group',0,'onloadanalysis',0,0]},d});
