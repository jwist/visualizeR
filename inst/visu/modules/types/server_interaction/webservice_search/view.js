'use strict';define(['jquery','modules/default/defaultview','src/util/ui'],function(a,b,c){'use strict';function d(){}return a.extend(!0,d.prototype,b,{init:function(){var g=this,h=this.module.getConfiguration;this.dom=a('<div></div>'),this.search=a('<table class="Search" cellpadding="5" cellspacing="0"><col width="100"><col width="*"></table>').css('width','90%'),this.dom.append(this.search),this.$feedback=a('<div id="ci-webservice-search-feedback"/>'),this.dom.append(this.$feedback),this.module.getDomContent().html(this.dom),this.oldVal={},this._url=!1;var j;if(j=h('searchparams')){for(var k in j)k&&j[k].label&&this.search.append('<tr><td><nobr>'+j[k].label+'</nobr></td><td>'+this._makeFormEl(j[k],k)+'</td></tr>');h('url');this.button=h('button',!1),this.button&&require(['forms/button'],function(n){g.dom.append((g.buttonInst=new n(h('buttonlabel')||'Search',function(){var o=Promise.resolve(!0);g.module.getConfigurationCheckbox('askConfirm','yes')&&(o=c.confirm(g.module.getConfiguration('confirmText'))),o.then(function(p){p&&g.module.controller.doSearch()})})).render())}),this.search.on('keyup','input[type=text], textarea',function(n){var o=a(this),p=o.val();'float'===o.attr('data-type')&&(p=parseFloat(p));var q=o.attr('name');return g.oldVal[q]&&g.oldVal[q]===p||o.trigger('change'),void 0!==q&&g.module.controller.addValue({name:q,destination:o.attr('data-dest')},p),g.button?void(g.buttonInst&&13==n.keyCode&&g.module.controller.doSearch()):void g.module.controller.doSearch()}),this.search.on('change','select',function(){var n=a(this),o=n.val();'float'===n.attr('data-type')&&(o=parseFloat(o));var p=n.attr('name');void 0!==p&&g.module.controller.addValue({name:p,destination:n.attr('data-dest')},o),g.button||g.module.controller.doSearch()}),this.search.on('change','input[type=checkbox]',function(){var n=a(this),o=n.is(':checked'),p=n.attr('name');void 0!==p&&g.module.controller.addValue({name:p,destination:n.attr('data-dest')},o),g.button||g.module.controller.doSearch()})}this.resolveReady()},_makeFormEl:function(g){var j='name="'+g.name+'" data-dest="'+g.destination+'" data-type="'+g.fieldtype+'"';switch(g.fieldtype){case'combo':var m,k=(g.fieldoptions||'').split(';'),n='';n+='<option '+(''==g.defaultvalue?'selected="selected" ':'')+'value=""></option>';for(var o=0,p=k.length;o<p;o++)m=k[o].split(':'),n+='<option '+(g.defaultvalue==m[0]?'selected="selected" ':'')+'value="'+m[0]+'">'+(m[1]||m[0])+'</option>';return'<select '+j+'>'+n+'</select>';case'checkbox':return'<input type="checkbox" '+(g.defaultvalue?'checked="checked"':'')+' value="1" offvalue="0" '+j+' />';case'textarea':return'<textarea '+j+' style="width: 100%" '+(g.fieldoptions||'')+'>'+(g.defaultvalue||'')+'</textarea>';default:case'float':case'text':return'<input type="text" value="'+(g.defaultvalue||'')+'" '+j+' style="width: 100%" />';}},inDom:function(){this.search.find('input:last').trigger('change')},lock:function(){this.locked=!0,this.buttonInst&&(this.buttonInst.setTitle(this.module.getConfiguration('buttonlabel_exec','Loading...')||'Loading...'),this.buttonInst.disable())},unlock:function(){this.locked=!1,this.buttonInst&&(this.buttonInst.setTitle(this.module.getConfiguration('buttonlabel','Search')||'Search'),this.buttonInst.enable())},update:{vartrigger:function(g){void 0==g||this.module.controller.doSearch()},url:function(g){this._url=g.get()}},onActionReceive:{doSearch:function(){this.module.controller.doSearch()},buttonColor:function(g){this.buttonInst&&this.buttonInst.setColor(g)}},showError:function(){this.$feedback.html('Error').css('color','red'),this._feedbackTimeout()},showSuccess:function(g){this.$feedback.html('Request successful with status '+g).css('color','green'),this._feedbackTimeout()},_feedbackTimeout:function(){var g=this;this._ftimeout&&clearTimeout(this._ftimeout),this._ftimeout=setTimeout(function(){g.$feedback.html('')},5e3)}}),d});
