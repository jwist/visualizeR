'use strict';define(['modules/default/defaultview','src/util/util','jquery','components/onde/src/onde','forms/button','lodash','src/util/debug','src/util/api','src/util/sandbox'],function(a,b,c,d,f,g,h,i,j){'use strict';function k(){this._id=b.getNextUniqueId()}return b.loadCss('components/onde/src/onde.css'),c.extend(!0,k.prototype,a,{init(){var l=this.module.getConfiguration('onchangeFilter');if(l){var m=new j;m.setContext({API:i}),this.filter=m.run('(function ondeOnChangeFilter(data, jpath) { try { \n '+l+'\n } catch(_) { console.log(_); } })','ondeOnChangeFilter')}this.dom=c('<form id="'+this._id+'">').css({height:'100%',width:'100%',textAlign:'left'}).append(c('<div class="onde-panel">')),this.module.getConfigurationCheckbox('hasButton','show')&&this.dom.append(new f(this.module.getConfiguration('button_text'),()=>{this.exportForm()},{color:'green'}).render().css({marginTop:'10px'})),this.dom.on('submit',(p)=>{return p.preventDefault(),this.exportForm(),!1});var n=this.module.getConfiguration('debouncing',-1);if(-1<n){var o=()=>{this.exportForm()};0<n&&(o=g.debounce(o,n)),registerCallback(this.dom,o)}this.filter&&registerCallback(this.dom,(p)=>{this._doFilter(p)}),this.inputVal=null},_doFilter(l){var m=!0,n=c(l.target),o=n.data('fieldInfo');o||(o=n.parents('ol').first().data('fieldInfo')),o||(m=!1);for(var q,r,p=o.jpath.slice().reverse();-1<p.indexOf('$array$')&&(q=n.parents('ol').first(),!!q.length)&&!!c.contains(this.dom[0],q[0]);)r=q.children('li').index(n.parents('li.field.array-item')[0]),n=q,p[p.indexOf('$array$')]=r;p=p.reverse(),(-1<p.indexOf('$array$')||-1<p.indexOf(-1))&&(m=!1),m?this.filter(this.form.getData(),p):h.warn('Onde: Could not resolve jpath of modified element')},blank:{inputValue(){this.inputObj=null,this.inputVal=null},schema(){this.module.controller.inputSchema={}}},inDom(){this.module.getDomContent().html(this.dom),this.initForm();var l;this.module.getConfigurationCheckbox('saveInView','yes')&&(l=this.module.getConfiguration('varname')),l?i.createData(l,JSON.parse(this.module.getConfiguration('data'))).then((m)=>{m.onChange(()=>{this.module.definition.configuration.groups.data[0].data[0]=JSON.stringify(m)}),this.resolveReady()}):this.resolveReady()},initForm(){this.form=new d.Onde(this.dom),this.renderForm(),this.form.on('field:delete',()=>{this.exportForm()})},update:{inputValue:function(m){this.inputObj=m,this.inputVal=m.get().resurrect(),this.renderForm()},schema:function(m){this.module.controller.inputSchema=m.resurrect(),this.renderForm()}},renderForm(){var l=this.module.controller.getSchema();if(!l)return void this.dom.find('.form-button').hide();this.dom.find('.form-button').show();var m=this.inputObj?this.inputObj.get().resurrect():null;this.form.render(l,m,{}),this.module.getConfigurationCheckbox('hasButton','onload')&&this.exportForm()},exportForm(){var l=this.form.getData();l.errorCount||(this._data=l.data,this.module.controller.onSubmit(l.data))}}),k});function registerCallback(a,b){a.on('input',b),a.on('change','[type="checkbox"]',b),a.on('change','[type="radio"]',b)}
