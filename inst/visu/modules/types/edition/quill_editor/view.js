'use strict';define(['jquery','modules/default/defaultview','src/util/util','quill','quillImageResizeModule','lodash','src/main/grid','quillImageDropModule'],function(a,b,c,d,e,f){'use strict';function h(){this._id=c.getNextUniqueId()}function i(j){return'all'===j?[[{header:[1,2,3,4,!1]}],[{font:[]}],[{size:['small',!1,'large','huge']}],[{color:[]},{background:[]}],['bold','italic','underline','strike'],['link','image','video','code-block','blockquote','code'],[{align:[]}],[{list:'ordered'},{list:'bullet'}],[{script:'sub'},{script:'super'}],[{indent:'-1'},{indent:'+1'}],[{direction:'rtl'}],['formula'],['clean']]:'light'===j?[[{header:[1,2,3,4,!1]}],[{color:[]}],['bold','italic'],['link','image','blockquote'],[{align:[]}],[{list:'bullet'}],[{script:'sub'},{script:'super'}]]:'minimal'===j?[[{header:[1,2,3,4,!1]},{color:[]},'bold','italic',{align:[]},{list:'bullet'}]]:void 0}return d.register('modules/ImageResize',e.default),a.extend(!0,h.prototype,b,{init:function(){var k=this;this.debounce=this.module.getConfiguration('debouncing'),this.storeInView=this.module.getConfigurationCheckbox('storeInView','yes'),this.valueChanged=f.debounce(function(){k.module.controller.valueChanged.apply(k.module.controller,arguments)},this.debounce)},inDom:function(){this.initEditor()},initEditor:function(){c.loadCss('./components/quill/quill.core.css').then(()=>{return c.loadCss('./components/quill/quill.snow.css')}).then(()=>{return c.loadCss('node_modules/katex/dist/katex.min.css')}).then(()=>{var k=this.module.definition.richtext||'';this.$content=a(`<div id="${this._id}" class="quill_editor" />`),this.dom=a('<div class="quill_wrapper" />'),this.$content.appendTo(this.dom),this.module.getDomContent().html(this.dom);var l=!this.module.getConfigurationCheckbox('editable','isEditable');this.instance=new d('#'+this._id,{modules:{clipboard:{matchVisual:!1},imageDrop:!0,ImageResize:{},formula:!0,toolbar:!l&&i(this.module.getConfiguration('toolbarMode'))},placeholder:'Start composing here...',readOnly:l,theme:'snow'}),this.$content.find('[data-toggle="tooltip"]').tooltip(),this.storeInView&&(this.instance.setContents(k),this.module.controller.valueChanged(k)),this.instance.on('text-change',()=>{this.valueChanged(this.instance.getContents())}),this.resolveReady()})},update:{html:function(k){this.module.data=k,this.clear(),this.mode='html',this.instance.clipboard.dangerouslyPasteHTML(0,k.get())},quill:function(k){this.module.data=k,this.clear(),this.mode='quill',this.instance.setContents(k.get())}},blank:{html:function(){this.clear()},quill:function(){this.clear()}},clear(){var j=this.instance.getLength();this.instance.deleteText(0,j)},onActionReceive:{insertHtml:function(k){this.instance.focus(),k+='';var l=this.instance.getSelection();this.instance.deleteText(l.index,l.length),this.instance.clipboard.dangerouslyPasteHTML(l.index,k)},insertText:function(k){this.instance.focus(),k+='';var l=this.instance.getSelection();this.instance.deleteText(l.index,l.length),this.instance.clipboard.insertText(l.index,k)}}}),h});
