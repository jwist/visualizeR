'use strict';define(['jquery','modules/default/defaultview','src/util/util','ckeditor','lodash','src/main/grid','chroma'],function(a,b,c,d,e,f,g){'use strict';function h(){this._id=c.getNextUniqueId()}return a.extend(!0,h.prototype,b,{init:function(){var j=this;this.plainHtml=this.module.getConfigurationCheckbox('plainHtml','yes'),this.debounce=this.module.getConfiguration('debouncing'),this.storeInView=this.module.getConfigurationCheckbox('storeInView','yes'),this.valueChanged=e.debounce(function(){j.module.controller.valueChanged.apply(j.module.controller,arguments)},this.debounce)},inDom:function(){this.initEditor()},blank:{html:function(){this.updateEditor('')}},update:{html:function(j){this.module.data=j;var k=j.get();this.storeInView&&(this.module.definition.richtext=k),this.updateEditor(k)}},initEditor:function(){var j=this,k=this.module.definition.richtext||'';if(this.readOnly=!this.module.getConfigurationCheckbox('editable','isEditable'),this.readOnly&&this.plainHtml)this.dom=a('<div>'),this.storeInView&&this.dom.html(k),this.module.getDomContent().html(this.dom),this._setCss();else{this.dom=a('<div id="'+this._id+'" contenteditable="true">'),this.storeInView&&(this.dom.html(k),this.module.controller.valueChanged(k)),this.module.getDomContent().html(this.dom),this._setCss(),d.instances[this._id]&&d.instances[this._id].destroy(),d.disableAutoInline=!0;var l={extraPlugins:'mathjax,font,sourcedialog,codesnippet',removeButtons:'',language:'en',mathJaxLib:'//cdn.mathjax.org/mathjax/2.2-latest/MathJax.js?config=TeX-AMS_HTML'};this.readOnly&&(l.readOnly=!0,l.removePlugins='toolbar',l.allowedContent=!0),this.instance=d.inline(this._id,l),this.instance.on('change',function(){j.valueChanged(j.instance.getData()),j.module.getConfigurationCheckbox('autoHeight','yes')&&(j.module.getDomWrapper().height(j.getContentHeight()+50),f.moduleResize(j.module))}),this.instance.on('loaded',function(){j.resolveReady()})}},updateEditor:function(j){j+='',this.plainHtml?this.dom.html(j):this.instance.setData(j)},getContentHeight:function(){var j=0;return this.dom.children().each(function(){j+=a(this).height()}),j},onActionReceive:{insertHtml:function(j){this.instance.insertHtml(j,'unfiltered_html')},insertText:function(j){setImmediate(()=>{this.instance.insertText(j)})}},_setCss:function(){var j=this.module.getConfiguration('bgColor');if(this.dom.css({height:'100%',width:'100%',padding:'5px',boxSizing:'border-box'}),this.module.getConfigurationCheckbox('postit','yes')){var k=g(j[0],j[1],j[2]);this.dom.addClass('richtext-postit'),this.dom.parents('.ci-module-wrapper').addClass('ci-module-richtext-postit'),this.dom.css({background:c.getCssVendorPrefix()+'radial-gradient(center, ellipse cover, '+k.brighter().hex()+' 0%, '+k.hex()+' 100%)'})}else this.dom.css({background:''}),this.dom.css({"background-color":'rgba('+j.join(',')+')'}),this.dom.removeClass('richtext-postit'),this.dom.parents('.ci-module-wrapper').removeClass('ci-module-richtext-postit')}}),h});
