'use strict';define(['require'],function(require){'use strict';function doScripts(){var data=getActionScripts();if(data&&!evaluatedScripts){for(var evaled={},i=0,l=data.length;i<l;i++)eval('evaled[ [ data[ i ].groups.action[ 0 ].name[ 0 ] ] ] = function(value) { '+data[i].groups.action[0].script[0]+' }');evaluatedScripts=evaled}}function getActionScripts(){return Versioning.getView().actionscripts||[]}function setActionScripts(a){evaluatedScripts=void 0,Versioning.getView().actionscripts=a,doScripts(a)}function setActionFiles(a){Versioning.getView().actionfiles=a,doFiles()}function doFiles(){var a=Versioning.getView().actionfiles;if(actionsFiles={},!!a)for(var e=0,f=a[0].groups.action[0].length;e<f;e++)actionsFiles[a[0].groups.action[0][e].name]=actionsFiles[a[0].groups.action[0][e].name]||[],actionsFiles[a[0].groups.action[0][e].name].push({file:a[0].groups.action[0][e].file,mode:a[0].groups.action[0][e].mode})}function executeActionFile(a,b){switch(a.mode){case'amd':require([a.file],function(d){d(b)});break;case'worker':var c=new Worker(a.file);c.postMessage({method:'actionValue',value:b}),c.onmessage=function(d){if(d.data.method)switch(d.data.method){case'getVar':if(!Array.isArray(d.data.variables instanceof Array))return;for(var e={},f=0,g=d.data.variables.length;f<g;f++)e[d.data.variables[f]]=API.getVar(d.data.variables[f]);c.postMessage({method:'getVar',variables:e});break;case'setVar':if(!d.data.variables)return;for(var f in d.data.variables)API.setVar(f,d.data.variables[f]);break;case'terminate':c.terminate();break;case'sendAction':if(!d.data.actionName)return;API.doAction(d.data.actionName,d.data.actionValue);break;case'highlight':if(!d.data.highlightId)return;API.highlightId(d.data.highlightId,d.data.highlightValue||!1);}};}}var Versioning;require(['src/util/versioning'],function(a){Versioning=a});var API;require(['src/util/api'],function(a){API=a});var evaluatedScripts,actionsFiles;return{setScriptsFromForm:function(b){setActionScripts(b)},setFilesFromForm:function(b){setActionFiles(b)},viewHasChanged:function(b){setActionScripts(b.actionscripts),doFiles()},getScriptsForm:function(){return Versioning.getView().actionscripts||[]},getFilesForm:function(){return Versioning.getView().actionfiles||[]},execute:function(b,c){if(evaluatedScripts[b]&&evaluatedScripts[b](c),actionsFiles[b])for(var d=0,e=actionsFiles[b].length;d<e;d++)executeActionFile(actionsFiles[b][d],c)}}});
